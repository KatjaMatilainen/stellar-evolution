;------------------------------------------------------------------------;
; Stellar structure and evolution
; Computer assignment for advanced students
;------------------------------------------------------------------------;

;  PART III - Polytropic constants

;------------------------------------------------------------------------;
; Use the subroutine PsPlot to save results in a postscript plot 
; (written by Heikki Salo)
;------------------------------------------------------------------------;

pro PsPlot,routine,filename
	thisdir=getenv('PWD')+'/'
	psopen,/color,dir=thisdir,filename
	call_procedure,routine
	psclose		
end
;------------------------------------------------------------------------;

;------------------------------------------------------------------------;
;  MAIN PROGRAM starts here
;------------------------------------------------------------------------;
;Compute Dn, Mn, Rn and Bn for each value of n.

pro stellar_part3

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=0
;------------------------------------------------------------------------;
n1=0.d0
results1=lane_emden(n1)
;Separate the results
ksi1=results1[*,0]
theta1=results1[*,1]
dtheta_dksi1=results1[*,2]

;------------------------------------------------------------------------;
; Rn (for n=0)
;------------------------------------------------------------------------;
;The program lane_emden cuts the results at theta=0, which means that
;the last term of the vector ksi is Rn

limit1=n_elements(ksi1)-1
Rn1=ksi1(limit1)
;print,theta1(limit1)
print,'Rn1(n=0)'
print,Rn1

;------------------------------------------------------------------------;
; Dn (for n=0)
;------------------------------------------------------------------------;
Dn1=-1.d0/(3.d0/Rn1*dtheta_dksi1(limit1))
print,'Dn1(n=0)'
print,Dn1

;------------------------------------------------------------------------;
; Mn (for n=0)
;------------------------------------------------------------------------;
Mn1=-Rn1^2*dtheta_dksi1(limit1)
print,'Mn1(n=0)'
print,Mn1

;------------------------------------------------------------------------;
; Bn (for n=0)
;------------------------------------------------------------------------;
;The equation would normally be:
;Bn1=(3.d0*Dn1)^((3-n1)/(3*n1))/((n1+1)*Mn^((n1-1)/n1)*Rn^((3-n1)/n1))
;n=0 is a special case, so for n->0 we define
Bn1=1.d0
print,'Bn1(n=0)'
print,Bn1

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=0.5
;------------------------------------------------------------------------;
n2=0.5d0
results2=lane_emden(n2)
;Separate the results
ksi2=results2[*,0]
theta2=results2[*,1]
dtheta_dksi2=results2[*,2]

;------------------------------------------------------------------------;
; Rn (for n=0.5)
;------------------------------------------------------------------------;
limit2=n_elements(ksi2)-1
Rn2=ksi2(limit2)
print,'Rn2(n=0.5)'
print,Rn2

;------------------------------------------------------------------------;
; Dn (for n=0.5)
;------------------------------------------------------------------------;
Dn2=-1.d0/(3.d0/Rn2*dtheta_dksi2(limit2))
print,'Dn2(n=0.5)'
print,Dn2

;------------------------------------------------------------------------;
; Mn (for n=0.5)
;------------------------------------------------------------------------;
Mn2=-Rn2^2*dtheta_dksi2(limit2)
print,'Mn2(n=0.5)'
print,Mn2

;------------------------------------------------------------------------;
; Bn (for n=0.5)
;------------------------------------------------------------------------;
Bn2=(3.d0*Dn2)^((3.d0-n2)/(3.d0*n2))/((n2+1.d0)*Mn2^((n2-1.d0)/n2)*Rn2^((3.d0-n2)/n2))
print,'Bn2(n=0.5)'
print,Bn2

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=1
;------------------------------------------------------------------------;
n3=1.d0
results3=lane_emden(n3)
;Separate the results
ksi3=results3[*,0]
theta3=results3[*,1]
dtheta_dksi3=results3[*,2]

;------------------------------------------------------------------------;
; Rn (for n=1)
;------------------------------------------------------------------------;
limit3=n_elements(ksi3)-1
Rn3=ksi3(limit3)
print,'Rn3(n=1)'
print,Rn3

;------------------------------------------------------------------------;
; Dn (for n=1)
;------------------------------------------------------------------------;
Dn3=-1.d0/(3.d0/Rn3*dtheta_dksi3(limit3))
print,'Dn3(n=1)'
print,Dn3

;------------------------------------------------------------------------;
; Mn (for n=1)
;------------------------------------------------------------------------;
Mn3=-Rn3^2*dtheta_dksi3(limit3)
print,'Mn3(n=1)'
print,Mn3

;------------------------------------------------------------------------;
; Bn (for n=1)
;------------------------------------------------------------------------;
Bn3=(3.d0*Dn3)^((3.d0-n3)/(3.d0*n3))/((n3+1.d0)*Mn3^((n3-1.d0)/n3)*Rn3^((3.d0-n3)/n3))
print,'Bn3(n=1)'
print,Bn3

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=1.5
;------------------------------------------------------------------------;
n4=1.5d0
results4=lane_emden(n4)
;Separate the results
ksi4=results4[*,0]
theta4=results4[*,1]
dtheta_dksi4=results4[*,2]

;------------------------------------------------------------------------;
; Rn (for n=1.5)
;------------------------------------------------------------------------;
limit4=n_elements(ksi4)-1
Rn4=ksi4(limit4)
print,'Rn4(n=1.5)'
print,Rn4

;------------------------------------------------------------------------;
; Dn (for n=1.5)
;------------------------------------------------------------------------;
Dn4=-1.d0/(3.d0/Rn4*dtheta_dksi4(limit4))
print,'Dn4(n=1.5)'
print,Dn4

;------------------------------------------------------------------------;
; Mn (for n=1.5)
;------------------------------------------------------------------------;
Mn4=-Rn4^2*dtheta_dksi4(limit4)
print,'Mn4(n=1.5)'
print,Mn4

;------------------------------------------------------------------------;
; Bn (for n=1.5)
;------------------------------------------------------------------------;
Bn4=(3.d0*Dn4)^((3-n4)/(3*n4))/((n4+1.d0)*Mn4^((n4-1)/n4)*Rn4^((3.d0-n4)/n4))
print,'Bn4(n=1.5)'
print,Bn4

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=2
;------------------------------------------------------------------------;
n5=2.d0
results5=lane_emden(n5)
;Separate the results
ksi5=results5[*,0]
theta5=results5[*,1]
dtheta_dksi5=results5[*,2]

;------------------------------------------------------------------------;
; Rn (for n=2)
;------------------------------------------------------------------------;
limit5=n_elements(ksi5)-1
Rn5=ksi5(limit5)
print,'Rn5(n=2)'
print,Rn5

;------------------------------------------------------------------------;
; Dn (for n=2)
;------------------------------------------------------------------------;
Dn5=-1.d0/(3.d0/Rn5*dtheta_dksi5(limit5))
print,'Dn5(n=2)'
print,Dn5

;------------------------------------------------------------------------;
; Mn (for n=2)
;------------------------------------------------------------------------;
Mn5=-Rn5^2*dtheta_dksi5(limit5)
print,'Mn5(n=2)'
print,Mn5

;------------------------------------------------------------------------;
; Bn (for n=2)
;------------------------------------------------------------------------;
Bn5=(3.d0*Dn5)^((3.d0-n5)/(3.d0*n5))/((n5+1.d0)*Mn5^((n5-1)/n5)*Rn5^((3.d0-n5)/n5))
print,'Bn5(n=2)'
print,Bn5

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=2.5
;------------------------------------------------------------------------;
n6=2.5d0
results6=lane_emden(n6)
;Separate the results
ksi6=results6[*,0]
theta6=results6[*,1]
dtheta_dksi6=results6[*,2]

;------------------------------------------------------------------------;
; Rn (for n=2.5)
;------------------------------------------------------------------------;
limit6=n_elements(ksi6)-1
Rn6=ksi6(limit6)
print,'Rn6(n=2.5)'
print,Rn6

;------------------------------------------------------------------------;
; Dn (for n=2.5)
;------------------------------------------------------------------------;
Dn6=-1.d0/(3.d0/Rn6*dtheta_dksi6(limit6))
print,'Dn6(n=2.5)'
print,Dn6

;------------------------------------------------------------------------;
; Mn (for n=2.5)
;------------------------------------------------------------------------;
Mn6=-Rn6^2*dtheta_dksi6(limit6)
print,'Mn6(n=2.5)'
print,Mn6

;------------------------------------------------------------------------;
; Bn (for n=2.5)
;------------------------------------------------------------------------;
Bn6=(3.d0*Dn6)^((3.d0-n6)/(3.d0*n6))/((n6+1.d0)*Mn6^((n6-1)/n6)*Rn6^((3.d0-n6)/n6))
print,'Bn6(n=2.5)'
print,Bn6

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=3
;------------------------------------------------------------------------;
n7=3.d0
results7=lane_emden(n7)
;Separate the results
ksi7=results7[*,0]
theta7=results7[*,1]
dtheta_dksi7=results7[*,2]

;------------------------------------------------------------------------;
; Rn (for n=3)
;------------------------------------------------------------------------;
limit7=n_elements(ksi7)-1
Rn7=ksi7(limit7)
print,'Rn7(n=3)'
print,Rn7

;------------------------------------------------------------------------;
; Dn (for n=3)
;------------------------------------------------------------------------;
Dn7=-1.d0/(3.d0/Rn7*dtheta_dksi7(limit7))
print,'Dn7(n=3)'
print,Dn7

;------------------------------------------------------------------------;
; Mn (for n=3)
;------------------------------------------------------------------------;
Mn7=-Rn7^2*dtheta_dksi7(limit7)
print,'Mn7(n=3)'
print,Mn7

;------------------------------------------------------------------------;
; Bn (for n=3)
;------------------------------------------------------------------------;
Bn7=(3.d0*Dn7)^((3.d0-n7)/(3.d0*n7))/((n7+1.d0)*Mn7^((n7-1)/n7)*Rn7^((3.d0-n7)/n7))
print,'Bn7(n=3)'
print,Bn7

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=3.5
;------------------------------------------------------------------------;
n8=3.5d0
results8=lane_emden(n8)
;Separate the results
ksi8=results8[*,0]
theta8=results8[*,1]
dtheta_dksi8=results8[*,2]

;------------------------------------------------------------------------;
; Rn (for n=3.5)
;------------------------------------------------------------------------;
limit8=n_elements(ksi8)-1
Rn8=ksi8(limit8)
print,'Rn8(n=3.5)'
print,Rn8

;------------------------------------------------------------------------;
; Dn (for n=3.5)
;------------------------------------------------------------------------;
Dn8=-1.d0/(3.d0/Rn8*dtheta_dksi8(limit8))
print,'Dn8(n=3.5)'
print,Dn8

;------------------------------------------------------------------------;
; Mn (for n=3.5)
;------------------------------------------------------------------------;
Mn8=-Rn8^2*dtheta_dksi8(limit8)
print,'Mn8(n=3.5)'
print,Mn8

;------------------------------------------------------------------------;
; Bn (for n=3.5)
;------------------------------------------------------------------------;
Bn8=(3.d0*Dn8)^((3.d0-n8)/(3.d0*n8))/((n8+1.d0)*Mn8^((n8-1)/n8)*Rn8^((3.d0-n8)/n8))
print,'Bn8(n=3.5)'
print,Bn8

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=4
;------------------------------------------------------------------------;
n9=4.d0
results9=lane_emden(n9)
;Separate the results
ksi9=results9[*,0]
theta9=results9[*,1]
dtheta_dksi9=results9[*,2]

;------------------------------------------------------------------------;
; Rn (for n=4)
;------------------------------------------------------------------------;
limit9=n_elements(ksi9)-1
Rn9=ksi9(limit9)
print,'Rn9(n=4)'
print,Rn9

;------------------------------------------------------------------------;
; Dn (for n=4)
;------------------------------------------------------------------------;
Dn9=-1.d0/(3.d0/Rn9*dtheta_dksi9(limit9))
print,'Dn9(n=4)'
print,Dn9

;------------------------------------------------------------------------;
; Mn (for n=4)
;------------------------------------------------------------------------;
Mn9=-Rn9^2*dtheta_dksi9(limit9)
print,'Mn9(n=4)'
print,Mn9

;------------------------------------------------------------------------;
; Bn (for n=4)
;------------------------------------------------------------------------;
Bn9=(3.d0*Dn9)^((3.d0-n9)/(3.d0*n9))/((n9+1.d0)*Mn9^((n9-1)/n9)*Rn9^((3.d0-n9)/n9))
print,'Bn9(n=4)'
print,Bn9

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=4.5
;------------------------------------------------------------------------;
n10=4.5d0
results10=lane_emden(n10)
;Separate the results
ksi10=results10[*,0]
theta10=results10[*,1]
dtheta_dksi10=results10[*,2]

;------------------------------------------------------------------------;
; Rn (for n=4.5)
;------------------------------------------------------------------------;
limit10=n_elements(ksi10)-1
Rn10=ksi10(limit10)
print,'Rn10(n=4.5)'
print,Rn10

;------------------------------------------------------------------------;
; Dn (for n=4.5)
;------------------------------------------------------------------------;
Dn10=-1.d0/(3.d0/Rn10*dtheta_dksi10(limit10))
print,'Dn10(n=4.5)'
print,Dn10

;------------------------------------------------------------------------;
; Mn (for n=4.5)
;------------------------------------------------------------------------;
Mn10=-Rn10^2*dtheta_dksi10(limit10)
print,'Mn10(n=4.5)'
print,Mn10

;------------------------------------------------------------------------;
; Bn (for n=4.5)
;------------------------------------------------------------------------;
Bn10=(3.d0*Dn10)^((3.d0-n10)/(3.d0*n10))/((n10+1.d0)*Mn10^((n10-1)/n10)*Rn10^((3.d0-n10)/n10))
print,'Bn10(n=4.5)'
print,Bn10

;------------------------------------------------------------------------;
; Solve Lane-Emden for n=5
;------------------------------------------------------------------------;
n11=5.d0
results11=lane_emden(n11)
;Separate the results
ksi11=results11[*,0]
theta11=results11[*,1]
dtheta_dksi11=results11[*,2]

;------------------------------------------------------------------------;
; Rn (for n=5)
;------------------------------------------------------------------------;
limit11=n_elements(ksi11)-1
Rn11=ksi11(limit11)
print,'Rn11(n=5)'
print,Rn11

;------------------------------------------------------------------------;
; Dn (for n=5)
;------------------------------------------------------------------------;
Dn11=-1.d0/(3.d0/Rn11*dtheta_dksi11(limit11))
print,'Dn11(n=5)'
print,Dn11

;------------------------------------------------------------------------;
; Mn (for n=5)
;------------------------------------------------------------------------;
Mn11=-Rn11^2*dtheta_dksi11(limit11)
print,'Mn11(n=5)'
print,Mn11

;------------------------------------------------------------------------;
; Bn (for n=5)
;------------------------------------------------------------------------;
Bn11=(3.d0*Dn11)^((3.d0-n11)/(3.d0*n11))/((n11+1.d0)*Mn11^((n11-1)/n11)*Rn11^((3.d0-n11)/n11))
print,'Bn11(n=5)'
print,Bn11

end

;--------------------------------------------------------------------;
; Save the results to a PostScript file using PsPlot
;--------------------------------------------------------------------;

pro plot_everything
PsPlot, 'stellar_part3', 'stellar_part3.ps'
end
